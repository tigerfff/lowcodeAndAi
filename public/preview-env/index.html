<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä»£ç é¢„è§ˆç¯å¢ƒ</title>
  
  <!-- ç«‹å³æ‰§è¡Œçš„è¯Šæ–­è„šæœ¬ -->
  <script>
    console.log('ğŸ”µğŸ”µğŸ”µ é¢„è§ˆç¯å¢ƒ HTML å¼€å§‹è§£æ ğŸ”µğŸ”µğŸ”µ')
    console.log('å½“å‰ URL:', window.location.href)
    console.log('çˆ¶çª—å£å­˜åœ¨:', window.parent !== window)
    
    // å°è¯•å‘çˆ¶çª—å£å‘é€æ¶ˆæ¯
    try {
      if (window.parent && window.parent !== window) {
        console.log('ğŸ“¤ å°è¯•å‘é€ IFRAME_LOADING æ¶ˆæ¯ç»™çˆ¶çª—å£')
        window.parent.postMessage({ type: 'IFRAME_LOADING', timestamp: Date.now() }, '*')
      }
    } catch (e) {
      console.error('âŒ å‘é€æ¶ˆæ¯å¤±è´¥:', e)
    }
  </script>
  
  <!-- hui2.43.2 CSS -->
  <link rel="stylesheet" href="/hui2.43.2/lib/hui.css">
  
  <!-- hui-pro CSS -->
  <link rel="stylesheet" href="/hui-pro/page/dist/page.css">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #f0f2f5;
    }
    
    #preview-root {
      width: 100%;
      min-height: 100vh;
    }
    
    #preview-loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      font-size: 16px;
      color: #666;
    }
    
    #preview-error {
      padding: 20px;
      color: #f56c6c;
      background: #fef0f0;
      border: 1px solid #fde2e2;
      border-radius: 4px;
      margin: 20px;
    }
    
    #preview-error h3 {
      margin-bottom: 10px;
    }
    
    #preview-error pre {
      background: #fff;
      padding: 12px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 13px;
    }
    
    /* åŠ¨æ€æ³¨å…¥çš„æ ·å¼ä¼šæ·»åŠ åˆ°è¿™é‡Œ */
    #preview-styles {
      /* ç»„ä»¶çš„ <style> æ ‡ç­¾å†…å®¹ */
    }
  </style>
</head>
<body>
  <div id="preview-root">
    <div id="preview-loading">
      <i style="font-size: 24px; animation: spin 1s linear infinite;">âŸ³</i>
      <span style="margin-left: 8px;">æ­£åœ¨åˆå§‹åŒ–é¢„è§ˆç¯å¢ƒ...</span>
    </div>
  </div>
  
  <!-- åŠ¨æ€æ ·å¼å®¹å™¨ -->
  <div id="preview-styles"></div>
  
  <!-- å®šä¹‰ process å¯¹è±¡ï¼ˆå¿…é¡»åœ¨æ‰€æœ‰è„šæœ¬ä¹‹å‰ï¼‰ -->
  <script>
    console.log('ğŸ”µ å®šä¹‰ process å¯¹è±¡')
    if (typeof process === 'undefined') {
      window.process = { env: { NODE_ENV: 'development' } }
    }
    console.log('âœ… process å·²å®šä¹‰:', window.process)
  </script>
  
  <!-- æŒ‰é¡ºåºåŠ è½½ä¾èµ– -->
  <script>
    // åŠ¨æ€åŠ è½½è„šæœ¬å‡½æ•°
    function loadScript(src, callback, timeout = 10000) {
      console.log('â³ å¼€å§‹åŠ è½½:', src)
      var script = document.createElement('script')
      var loaded = false
      var timeoutId
      
      script.src = src
      
      script.onload = function() {
        if (!loaded) {
          loaded = true
          clearTimeout(timeoutId)
          console.log('âœ… åŠ è½½æˆåŠŸ:', src)
          if (callback) callback()
        }
      }
      
      script.onerror = function() {
        if (!loaded) {
          loaded = true
          clearTimeout(timeoutId)
          console.error('âŒ åŠ è½½å¤±è´¥:', src)
          if (callback) callback(new Error('åŠ è½½å¤±è´¥: ' + src))
        }
      }
      
      // æ·»åŠ è¶…æ—¶å¤„ç†
      timeoutId = setTimeout(function() {
        if (!loaded) {
          loaded = true
          console.error('âŒ åŠ è½½è¶…æ—¶:', src)
          if (callback) callback(new Error('åŠ è½½è¶…æ—¶: ' + src))
        }
      }, timeout)
      
      document.head.appendChild(script)
    }
    
    // åŠ è½½é¡ºåºï¼šVue -> hui -> hui-pro -> utils -> validators -> runtime
    function initPreview() {
      console.log('ğŸš€ å¼€å§‹åˆå§‹åŒ–é¢„è§ˆç¯å¢ƒ...')
      var startTime = Date.now()
      
      // 1. åŠ è½½ Vue 2
      loadScript('https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js', function(error) {
        if (error) {
          console.error('âŒ Vue åŠ è½½é”™è¯¯:', error.message)
          showErrorMessage('Vue åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥')
          return
        }
        
        // æ£€æŸ¥ Vue æ˜¯å¦å·²åŠ è½½
        if (typeof Vue === 'undefined') {
          console.error('âŒ Vue åŠ è½½å¤±è´¥ï¼šVue å¯¹è±¡ä¸å­˜åœ¨')
          showErrorMessage('Vue åŠ è½½å¤±è´¥')
          return
        }
        console.log('âœ… Vue å·²åŠ è½½:', Vue.version, 'è€—æ—¶:', Date.now() - startTime, 'ms')
        
        // 2. åŠ è½½ hui2.43.2
        loadScript('/hui2.43.2/lib/hui.umd.min.js', function(error) {
          if (error) {
            console.warn('âš ï¸ hui åŠ è½½é”™è¯¯:', error.message, 'ï¼ˆå°†ç»§ç»­åˆå§‹åŒ–ï¼‰')
          }
          console.log('ğŸ“¦ hui åŠ è½½å®Œæˆï¼Œè€—æ—¶:', Date.now() - startTime, 'ms')
          
          // 3. åŠ è½½ hui-pro
          loadScript('/hui-pro/page/dist/page.umd.min.js', function(error) {
            if (error) {
              console.warn('âš ï¸ hui-pro åŠ è½½é”™è¯¯:', error.message, 'ï¼ˆå°†ç»§ç»­åˆå§‹åŒ–ï¼‰')
            }
            console.log('ğŸ“¦ hui-pro åŠ è½½å®Œæˆï¼Œè€—æ—¶:', Date.now() - startTime, 'ms')
            
            // 4. åŠ è½½å·¥å…·åº“
            loadScript('/preview-env/utils.js', function(error) {
              if (error) {
                console.error('âŒ utils åŠ è½½é”™è¯¯:', error.message)
              }
              console.log('ğŸ“¦ utils åŠ è½½å®Œæˆï¼Œè€—æ—¶:', Date.now() - startTime, 'ms')
              
              // 5. åŠ è½½æ ¡éªŒåº“
              loadScript('/preview-env/validators.js', function(error) {
                if (error) {
                  console.error('âŒ validators åŠ è½½é”™è¯¯:', error.message)
                }
                console.log('ğŸ“¦ validators åŠ è½½å®Œæˆï¼Œè€—æ—¶:', Date.now() - startTime, 'ms')
                
                // 6. æœ€ååŠ è½½è¿è¡Œæ—¶
                loadScript('/preview-env/runtime.js', function(error) {
                  if (error) {
                    console.error('âŒ runtime åŠ è½½é”™è¯¯:', error.message)
                    showErrorMessage('é¢„è§ˆç¯å¢ƒåˆå§‹åŒ–å¤±è´¥')
                    return
                  }
                  console.log('âœ… æ‰€æœ‰ä¾èµ–åŠ è½½å®Œæˆï¼Œæ€»è€—æ—¶:', Date.now() - startTime, 'ms')
                })
              })
            })
          })
        })
      }, 15000) // Vue åŠ è½½è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º 15 ç§’
    }
    
    // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
    function showErrorMessage(message) {
      var root = document.getElementById('preview-root')
      root.innerHTML = '<div style="padding: 40px; text-align: center; color: #f56c6c;">' +
        '<i class="el-icon-warning" style="font-size: 48px; margin-bottom: 16px;"></i>' +
        '<h3>é¢„è§ˆç¯å¢ƒåŠ è½½å¤±è´¥</h3>' +
        '<p>' + message + '</p>' +
        '<p style="font-size: 12px; color: #909399; margin-top: 10px;">è¯·åˆ·æ–°é¡µé¢é‡è¯•</p>' +
        '</div>'
    }
    
    // ç«‹å³å¼€å§‹åˆå§‹åŒ–
    console.log('ğŸ¯ HTML è§£æå®Œæˆï¼Œå¼€å§‹æ‰§è¡Œ initPreview()')
    try {
      initPreview()
    } catch (error) {
      console.error('âŒ initPreview() æ‰§è¡Œå¤±è´¥:', error)
      showErrorMessage('åˆå§‹åŒ–å¤±è´¥: ' + error.message)
    }
  </script>
  
  <style>
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>
</body>
</html>

