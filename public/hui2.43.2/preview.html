<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>HUI 本地包预览</title>

    <!-- 建议优先使用 lib/hui.css（已打包样式） -->
    <link rel="stylesheet" href="./lib/hui.css" />
    <script src="https://unpkg.com/vue@2.7.16/dist/vue.min.js"></script>

    <style>
      body { margin: 0; font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial; }
      .banner { padding: 8px 12px; font-size: 12px; color: #666; background: #f7f7f7; border-bottom: 1px solid #eee; }
      #app { padding: 16px; }
      .warn { color: #b05700; }
      .ok { color: #067d00; }
    </style>
  </head>
  <body>
    <div class="banner">此页用于校验：本地 hui.js 是否可作为“本地 CDN”通过 &lt;script&gt; 直接使用。</div>
    <div id="app">
      <p>加载中…</p>
    </div>

    <!-- 通过 import map 解决 HUI 内部对 "hui/..." 裸模块路径的解析问题 -->
    <script type="importmap">
      {
        "imports": {
            "vue": "https://esm.sh/vue@2.7.16?bundle",
            "hui/": "./lib/",
            "hui": "./lib/hui.js"
        }
      }
    </script>

    <script type="module">
      // 采用：Vue2（UMD，全局 window.Vue）+ HUI（ESM import）
      // 如外网受限，可将上方 UMD Vue 改为本地文件路径
      const huiEsmUrl = './lib/hui.js'; // 若存在 ./lib/hui.esm-browser.js，可改用它

      async function boot() {
        try {
          const HUI = await import(huiEsmUrl);
          console.log(plugin,'plugin');
          const plugin = HUI.default || HUI;
         

          const Vue = window.Vue;
          if (!Vue) throw new Error('错误');

          // 暴露到全局，便于调试
          window.HUI = plugin;

          if (plugin && plugin.install) Vue.use(plugin);

          new Vue({
            el: '#app',
            data: function () { return { ok: true }; },
            template: '<div><p class="ok">HUI（ESM）与 Vue2（UMD）加载成功</p><div>现在可以尝试渲染一个最小组件。</div></div>'
          });
        } catch (e) {
          const appEl = document.getElementById('app');
          appEl.innerHTML = '<p class="warn">加载失败：' + (e && e.message ? e.message : e) + '</p>';
        }
      }

      // 等待全局 Vue 可用后再执行（避免网络波动引起的先后次序问题）
      if (window.Vue) {
        boot();
      } else {
        window.addEventListener('load', function () { if (window.Vue) boot(); });
        // 轮询最多 3 秒作为兜底
        const timer = setInterval(function () {
          if (window.Vue) { clearInterval(timer); boot(); }
        }, 50);
        setTimeout(function(){ clearInterval(timer); }, 3000);
      }
    </script>
  </body>
  </html>


