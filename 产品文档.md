## 产品文档 · 简版低代码本地出码工具（Vue2 + 指定组件库）

### 1. 背景与目标

- **目标**：基于“标准模板容器 + 占位 + 接口文档”的方式，零/低配置自动生成可复制的 Vue2 页面代码，严格使用指定组件库（如 hui）。
- **不做**：在线发布、复杂拖拽布局、运行时渲染平台。核心是“AI 出码 + 轻量确认 + 一键复制”。

### 2. 关键理念

- **典型模板**：用户选择预设的典型页面模板（如"标准列表页"、"左树右表页"），模板包含完整的布局结构，无需手动配置。
- **布局固定**：模板的布局结构（组件、slot、层级关系）由团队预先设计并固化，保证代码一致性与规范性。
- **AI 聚焦数据**：AI 只负责推断数据相关内容（表格列、分页映射、下拉选项、搜索字段），不推断布局。
- **零配置推断**：只关联接口文档（OpenAPI/示例响应），AI 自动完成列、分页、下拉选项、默认值与校验的推断与生成。
- **可选增强**：支持上传页面截图，仅用于推断列顺序/显隐等视觉偏好，不是必填。

### 3. 用户流程（MVP）

1) 选择典型页面模板（如"标准列表页"、"左树右表页"、"基础表单页"）。
   - 查看模板预览图，了解布局效果
   - 模板布局已固定，无需手动配置组件与 slot
2) 关联接口文档（粘贴 OpenAPI JSON、或请求/响应示例、或填写 HTTPS 接口地址）。
3) （可选）上传页面截图用于列顺序与显隐建议。
4) AI 自动推断数据映射，生成"确认面板"：
   - 表格列（字段名、显示标签、类型、宽度）
   - 分页参数映射（page/pageSize/total）
   - 搜索字段（基于请求参数推断）
   - 下拉选项来源（枚举字段识别）
   - 默认值与校验规则
5) 用户微调（仅在必要时）→ 一键生成 Vue2 代码 → 复制粘贴到项目。

### 4. 模板与组件（基于 hui 组件库）

- **典型页面模板**（MVP 阶段）：
  - 标准列表页：`h-page-container` + `h-page-search` + `h-paged-table`
  - 左树右表页：左侧树形导航 + 右侧列表
  - 基础表单页：`h-page-container` + `el-form` + 表单项
  - 详情查看页：只读信息展示
- **组件库**：所有生成代码依赖 `@hui/` 组件库（独立组件库，非 Element UI）
- **关键组件**（从 hui/*.md 提取元数据）：
  - 布局类：`h-page-container`, `h-page-header`, `h-page-content`, `h-page-search`
  - 表格类：`h-paged-table`（集成表格+分页）, `el-table`, `el-table-column`
  - 表单类：`el-form`, `el-form-item`, `el-input`, `el-select`, `el-date-picker`, `el-button`
  - 其他：`el-tag`, `dynamic-form`, `cascader` 等

### 5. 配置数据契约（最小集）

```json
{
  "templateId": "standard-list",
  "pageName": "CustomerList",
  "breadcrumb": ["客户管理", "客户列表"],
  "api": {
    "url": "/api/customers",
    "method": "GET",
    "params": {
      "page": "page",
      "pageSize": "pageSize"
    },
    "sampleResponse": {
      "data": {
        "items": [
          {"id": 1, "name": "张三", "status": "active", "createdAt": "2024-01-01 10:00:00"}
        ],
        "total": 120
      }
    }
  },
  "dataMapping": {
    "dataPath": "json.data.items",
    "totalPath": "json.data.total"
  },
  "searchFields": [
    { "prop": "name", "label": "客户名称", "type": "input" },
    { "prop": "status", "label": "状态", "type": "select", "options": [
      {"label": "启用", "value": "active"},
      {"label": "停用", "value": "disabled"}
    ]}
  ],
  "columns": [
    { "prop": "id", "label": "ID", "width": "80" },
    { "prop": "name", "label": "客户名称" },
    { "prop": "status", "label": "状态", "type": "tag", "mapping": {
      "active": {"label": "启用", "type": "success"},
      "disabled": {"label": "停用", "type": "info"}
    }},
    { "prop": "createdAt", "label": "创建时间", "type": "datetime" }
  ]
}
```

说明：

- `templateId` 指定使用的典型页面模板，模板已定义完整布局结构。
- `dataMapping` 定义响应数据在 JSON 中的路径（适配 `h-paged-table` 的函数式映射）。
- `searchFields` 和 `columns` 由 AI 根据 API 样例推断生成，用户可在确认面板中微调。
- `api.params` 定义分页参数名称，支持不同 API 规范（page/pageSize vs current/size）。

### 6. AI 自动推断规则（聚焦数据映射）

AI 不推断布局（由模板定义），只推断以下数据相关内容：

- **表格列（columns）**：

  - 从 API 响应样例中提取数据项的字段（如 `sampleResponse.data.items[0]` 的键）
  - 列标题：优先使用字段名的语义转换（如 `createdAt` → "创建时间"），支持中英文
  - 列类型：基于字段名与示例值推断（`*Time/*At` → datetime；`status/type` → 枚举/Tag）
  - 列宽度：根据字段类型与内容长度推断（ID/序号 → 固定宽度；其他 → 自适应）
- **数据路径映射（dataMapping）**：

  - 分析响应结构，识别数据数组的路径（`data.items` vs `items` vs `result.list`）
  - 识别总数字段路径（`data.total` vs `total` vs `data.totalRecord`）
  - 生成 `h-paged-table` 所需的函数式映射表达式
- **分页参数（pagination）**：

  - 识别请求参数中的分页字段名（`page/pageSize` vs `current/size` vs `pageNum/pageCount`）
  - 支持不同 API 规范的自动适配
- **搜索字段（searchFields）**：

  - 从 API 请求参数中提取非分页参数（如 `name`, `status`）
  - 根据字段名与类型推断组件类型（`string` → input；枚举 → select）
- **下拉选项（options）**：

  - 识别枚举字段（字段名含 `status/type/category`，或值为有限集合）
  - 在响应中查找字典数据（`dict/options/enums` 等）
  - 推断 label/value 字段映射（优先级：`label/title/name` 和 `value/id/code`）
- **置信度标注**：

  - 对低置信度推断标注"需确认"，在确认面板中提供 1-3 个候选供用户选择

### 7. 确认面板（最小交互）

- **展示内容**：

  - 表格列清单（字段名、显示标签、类型、宽度、显隐、顺序）
  - 数据路径映射（dataPath、totalPath，带置信度标识）
  - 搜索字段列表（字段名、标签、组件类型、选项来源）
  - 分页参数映射（page、pageSize 对应的字段名）
  - 枚举字段的选项来源与映射规则
- **可调整操作**：

  - 显示/隐藏列、拖拽调整列顺序、修改列标题
  - 修改列类型（普通文本 → Tag → 日期格式等）
  - 选择数据路径（当 AI 低置信度时提供候选项）
  - 选择分页字段映射（从多个候选中选择）
  - 为 Select 字段指定 label/value 字段或手动配置选项
  - 编辑默认值与校验规则（可选）
- **一键生成代码**：确认后生成完整 Vue2 SFC + 可选 service 方法

### 8. 代码输出（Vue2 + hui 组件库）

- **产物**：

  - 单文件组件（.vue）：完整的 template/script/style（基于选定的模板渲染）
  - 可选 `service.js`：封装 API 请求方法与分页参数处理
  - 可选路由配置片段：便于快速挂载到项目
  - 生成报告：数据映射清单、依赖版本要求、注意事项
- **技术约束**：

  - 严格使用 `@hui/` 组件库（从 hui/*.md 提取的组件清单）
  - Vue2 Options API 风格
  - 导入语句、`v-model`/事件名、插槽/`slot-scope` 按 Vue2 规范
  - `h-paged-table` 使用函数式数据映射：`:data="(json) => json.data.items"`
- **质量保证**：

  - 生成前进行 Schema 校验（模板、页面配置、组件清单）
  - 语法校验（vue-template-compiler、ESLint）
  - 干跑测试（iframe 内 mock 数据挂载，检查表格渲染、分页切换）
  - 失败时不给出码，要求用户在确认面板修正或补充

### 9. 非功能性要求

- 本地运行，HTTPS 接口；开发态可配置代理。
- 不上传业务数据；图片上传仅用于本地推断（可选）。
- 生成稳定、可读、可复制；模板与风格统一。

### 10. MVP 范围

- **典型页面模板**（3-5 个）：

  - 标准列表页（搜索 + `h-paged-table`）
  - 基础表单页（必填/正则校验）
  - 详情查看页（只读展示）
- **核心组件**（从 hui 组件库）：

  - 布局：`h-page-container`, `h-page-header`, `h-page-content`, `h-page-search`
  - 表格：`h-paged-table`, `el-table`, `el-table-column`
  - 表单：`el-form`, `el-form-item`, `el-input`, `el-select`, `el-button`, `el-date-picker`
  - 其他：`el-tag`（状态标签）
- **数据能力**：

  - GET 列表接口（支持分页、搜索参数）
  - POST 表单提交
  - 分页参数自动识别与映射
  - 枚举字段的下拉选项自动识别
  - 响应数据路径自动推断（适配 `h-paged-table`）

### 11. 成功标准

- 用户选择模板 + 提供接口文档（或样例），即可自动生成可用代码；
- 确认面板平均 3 次以内点击即可完成微调（无需理解技术细节）；
- 生成的代码符合团队规范（布局、命名、风格一致）；
- 复制代码后在典型项目中 10 分钟内可运行通过基础验证（查询、分页、搜索、选项）。

### 12. 风险与应对

- 字段命名混乱 → 提供 `hints` 优先级；要求一次确认；支持样例响应。
- 复杂嵌套/跨字段校验 → 先生成基础可用版本，标注“需手工增强”的位置。
- 组件元数据缺失 → 维护最小组件清单（必填 props/常见事件）；缺失项用默认模板。

### 13. 迭代方向（可选）

- 模板库扩展与自定义（支持团队自定义模板导入）；
- 模板市场与分享（团队间共享典型模板）；
- 图片识别增强（更精准的列顺序、宽度、显隐推断）；
- 多接口组合（主列表 + 远程字典接口）；
- 代码优化建议（性能、无障碍性检查）；
- 导出生成报告与最小单元测试模板。
